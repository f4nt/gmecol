{% extends 'base.html' %}
{% block stage_header %}{{ game.name }}{% endblock %}
{% block stage_intro %}
<p>{{ game.platform.name }}</p>
{% endblock %}
{% block content %}
    <div class="span1">
        <p><img src="{{ game.image_url }}" /></p>
    </div>
    <div class="span5">
        <ul>
            <li>Title: {{ game.name }}</li>
            <li>Genres:</li>
                <ul>
                    {% for genre in game.genres.all %}
                        <li>{{ genre.name }}</li>
                    {% endfor %}
                </ul>
            <li>Platform: {{ game.platform.name }}</li>
        </ul>
    </div>
    <div class="span3">
        <div class="btn-group">
            {% if user_game %}

                {% if user_game.wish %}
                    <button class="btn btn-large" disabled="disabled">On Wishlist</button>
                    <button class="btn btn-large dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <!-- dropdown menu links -->
                        <li><a href="#">Rate</a></li>
                        <li><div class="rateit" data-rateit-value="{{ user_game.rating }}" data-rateit-ispreset="{% if user_game.rating %}true{% else %}false{% endif %}" id="game-rating"></div></li>
                        <li class="divider"></li>
                        <li><a href="{% url "add-game-to-collection" game.pk %}">Add to Collection</a></li>
                {% else %}
                    <button class="btn btn-large" disabled="disabled">In Collection</button>
                    <button class="btn btn-large dropdown-toggle" data-toggle="dropdown">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <!-- dropdown menu links -->
                        <li><div class="rateit" data-rateit-value="{{ user_game.rating }}" data-rateit-ispreset="{% if user_game.rating %}true{% else %}false{% endif %}" id="game-rating"></div></li>
                        <li class="divider"></li>
                        <li><a id='trade-game'>For Trade: {% if user_game.for_trade %}<i id="trade-icon" class="icon-ok"></i>{% else %}<i id="trade-icon" class="icon-off"></i>{% endif %}</a></li>
                        <li><a id='sell-game'>For Sale: {% if user_game.for_sale %}<i id="sell-icon" class="icon-ok"></i>{% else %}<i id="sell-icon" class="icon-off"></i>{% endif %}</a></li>

                {% endif %}
                
            {% else %}
                
                {% if request.user.is_authenticated %}
                    <p>
                    <a href="{% url "add-game-to-wish" game.pk %}"><button class="btn btn-large btn-primary add-wish">Add to WishList</button></a>
                    </p>
                    <p>
                        <a href="{% url "add-game-to-collection" game.pk %}"><button class="btn btn-large btn-primary add-collect">Add to Collection</button></a>
                    </p>
                {% endif %}

            {% endif %}
        </div>
    </div>
{% endblock %}
{% block extra_js %}
    <script type="text/javascript">
        $(document).ready(function(){
            $('#game-rating').bind('rated', function(event, value){
                $.ajax({
                    type: "GET",
                    url: '{% url "rate-game" game.pk %}',
                    data: { score: value }
                });
            });
            $('#game-rating').bind('reset', function(){
                $.ajax({
                    type: "GET",
                    url: '{% url "rate-game" game.pk %}',
                    data: { score: 0 }
                });
            });
            $('#trade-game').click(function(data){
                $.ajax({
                    type: "GET",
                    url: '{% url "trade-game" game.pk %}',
                    success: function(data){
                        if(data.for_trade){
                            $('#trade-icon').attr('class', 'icon-ok');
                        } else {
                            $('#trade-icon').attr('class', 'icon-off');
                        }
                    }
                });
            });
            $('#sell-game').click(function(data){
                $.ajax({
                    type: "GET",
                    url: '{% url "sell-game" game.pk %}',
                    success: function(data){
                        if(data.for_sale){
                            $('#sell-icon').attr('class', 'icon-ok');
                        } else {
                            $('#sell-icon').attr('class', 'icon-off');
                        }
                    }
                });
            });
        });
    </script>
{% endblock %}
